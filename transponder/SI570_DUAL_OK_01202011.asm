
; PICBASIC PRO(TM) Compiler 2.60C, (c) 1998, 2011 microEngineering Labs, Inc. All Rights Reserved. 
_USED			EQU	1

	INCLUDE	"C:\PIC\PBP260\18F2550.INC"


; Define statements.
#define		OSC		 4           
#define		I2C_SLOW		 1
#define		I2C_SCLOUT		 1

RAM_START       		EQU	00000h
RAM_END         		EQU	007FFh
RAM_BANKS       		EQU	00008h
BANK0_START     		EQU	00060h
BANK0_END       		EQU	000FFh
BANK1_START     		EQU	00100h
BANK1_END       		EQU	001FFh
BANK2_START     		EQU	00200h
BANK2_END       		EQU	002FFh
BANK3_START     		EQU	00300h
BANK3_END       		EQU	003FFh
BANK4_START     		EQU	00400h
BANK4_END       		EQU	004FFh
BANK5_START     		EQU	00500h
BANK5_END       		EQU	005FFh
BANK6_START     		EQU	00600h
BANK6_END       		EQU	006FFh
BANK7_START     		EQU	00700h
BANK7_END       		EQU	007FFh
BANKA_START     		EQU	00000h
BANKA_END       		EQU	0005Fh

FLAGS           		EQU	RAM_START + 000h
R0              		EQU	RAM_START + 001h
R1              		EQU	RAM_START + 003h
R2              		EQU	RAM_START + 005h
R3              		EQU	RAM_START + 007h
R4              		EQU	RAM_START + 009h
R5              		EQU	RAM_START + 00Bh
R6              		EQU	RAM_START + 00Dh
R7              		EQU	RAM_START + 00Fh
R8              		EQU	RAM_START + 011h
GOP             		EQU	RAM_START + 013h
RM1             		EQU	RAM_START + 014h
RM2             		EQU	RAM_START + 015h
RR1             		EQU	RAM_START + 016h
RR2             		EQU	RAM_START + 017h
RS1             		EQU	RAM_START + 018h
RS2             		EQU	RAM_START + 019h
PB01            		EQU	RAM_START + 01Ah
_i2c_in          		EQU	RAM_START + 01Bh
_temp            		EQU	RAM_START + 01Dh
_DONGU           		EQU	RAM_START + 01Fh
_i2c_out         		EQU	RAM_START + 020h
_PORTL           		EQU	 PORTB
_PORTH           		EQU	 PORTC
_TRISL           		EQU	 TRISB
_TRISH           		EQU	 TRISC
#define _SDA             	_PORTC??7
#define _SCL             	_PORTC??5
#define _SDA2            	_PORTC??4
#define _SCL2            	_PORTC??3
#define _i2c_ack         	 PB01, 000h
#define _PORTC??7        	 PORTC, 007h
#define _PORTC??5        	 PORTC, 005h
#define _PORTC??4        	 PORTC, 004h
#define _PORTC??3        	 PORTC, 003h
#define _PORTB??7        	 PORTB, 007h

; Constants.
_USBMEMORYADDRESS		EQU	00400h
_i2c_read        		EQU	00001h
_i2c_write       		EQU	00000h

; EEPROM data.


	INCLUDE	"SI570_~2.MAC"
	INCLUDE	"C:\PIC\PBP260\PBPPIC18.LIB"


	LABEL?L	_config_start	

	LABEL?L	_config_end	
	MOVE?CB	000h, TRISB
	MOVE?CT	001h, _PORTB??7

	LABEL?L	_Start	
	MOVE?CB	001h, _DONGU
	LABEL?L	L00001	
	CMPGT?BCL	_DONGU, 003h, L00002
	GOSUB?L	_I2C_START
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	089h, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	010h, _i2c_out
	GOSUB?L	_I2C_TX
	GOSUB?L	_I2C_STOP
	PAUSE?C	00Ah
	GOSUB?L	_I2C_START
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	007h, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	0E0h, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	042h, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	0CBh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	0EBh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	06Fh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	0C9h, _i2c_out
	GOSUB?L	_I2C_TX
	GOSUB?L	_I2C_STOP
	PAUSE?C	00Ah
	GOSUB?L	_I2C_START
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	089h, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	000h, _i2c_out
	GOSUB?L	_I2C_TX
	GOSUB?L	_I2C_STOP
	PAUSE?C	00Ah
	GOSUB?L	_I2C_START
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	087h, _i2c_out
	GOSUB?L	_I2C_TX
	MOVE?CB	040h, _i2c_out
	GOSUB?L	_I2C_TX
	GOSUB?L	_I2C_STOP
	PAUSE?C	00Ah
	PAUSE?C	003E8h
	TOGGLE?T	_PORTB??7
	NEXT?BCL	_DONGU, 001h, L00001
	LABEL?L	L00002	
	MOVE?CB	001h, _DONGU
	LABEL?L	L00003	
	CMPGT?BCL	_DONGU, 003h, L00004
	GOSUB?L	_I2C_START2
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	089h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	010h, _i2c_out
	GOSUB?L	_I2C_TX2
	GOSUB?L	_I2C_STOP2
	PAUSE?C	00Ah
	GOSUB?L	_I2C_START2
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	007h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	060h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	042h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	060h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	0D5h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	0F7h, _i2c_out
	GOSUB?L	_I2C_TX2
	GOSUB?L	_I2C_STOP2
	PAUSE?C	00Ah
	GOSUB?L	_I2C_START2
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	089h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	000h, _i2c_out
	GOSUB?L	_I2C_TX2
	GOSUB?L	_I2C_STOP2
	PAUSE?C	00Ah
	GOSUB?L	_I2C_START2
	MOVE?CB	0AAh, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	087h, _i2c_out
	GOSUB?L	_I2C_TX2
	MOVE?CB	040h, _i2c_out
	GOSUB?L	_I2C_TX2
	GOSUB?L	_I2C_STOP2
	PAUSE?C	00Ah
	PAUSE?C	003E8h
	TOGGLE?T	_PORTB??7
	NEXT?BCL	_DONGU, 001h, L00003
	LABEL?L	L00004	
	GOTO?L	_BITIS

	LABEL?L	_I2C_START	
	HIGH?T	_SDA
	HIGH?T	_SCL
	LOW?T	_SDA
	LOW?T	_SCL
	RETURN?	

	LABEL?L	_I2C_STOP	
	LOW?T	_SDA
	HIGH?T	_SCL
	HIGH?T	_SDA
	PAUSE?C	001h
	RETURN?	

	LABEL?L	_I2C_RX	
	SHIFTDATA?T	_SDA
	SHIFTCLOCK?T	_SCL
	SHIFTMODE?C	000h
	SHIFTIN?BC	_i2c_in, 008h
	SHIFTDATA?T	_SDA
	SHIFTCLOCK?T	_SCL
	SHIFTMODE?C	001h
	SHIFTOUT?CC	000h, 001h
	SHIFTDATA?T	_SDA
	SHIFTCLOCK?T	_SCL
	SHIFTMODE?C	000h
	SHIFTIN?BC	_i2c_in + 00001h, 008h
	SHIFTDATA?T	_SDA
	SHIFTCLOCK?T	_SCL
	SHIFTMODE?C	001h
	SHIFTOUT?CC	001h, 001h
	RETURN?	

	LABEL?L	_I2C_TX	
	SHIFTDATA?T	_SDA
	SHIFTCLOCK?T	_SCL
	SHIFTMODE?C	001h
	SHIFTOUT?BC	_i2c_out, 008h
	SHIFTDATA?T	_SDA
	SHIFTCLOCK?T	_SCL
	SHIFTMODE?C	000h
	SHIFTIN?TC	_i2c_ack, 001h
	RETURN?	

	LABEL?L	_I2C_START2	
	HIGH?T	_SDA2
	HIGH?T	_SCL2
	LOW?T	_SDA2
	LOW?T	_SCL2
	RETURN?	

	LABEL?L	_I2C_STOP2	
	LOW?T	_SDA2
	HIGH?T	_SCL2
	HIGH?T	_SDA2
	PAUSE?C	001h
	RETURN?	

	LABEL?L	_I2C_RX2	
	SHIFTDATA?T	_SDA2
	SHIFTCLOCK?T	_SCL2
	SHIFTMODE?C	000h
	SHIFTIN?BC	_i2c_in, 008h
	SHIFTDATA?T	_SDA2
	SHIFTCLOCK?T	_SCL2
	SHIFTMODE?C	001h
	SHIFTOUT?CC	000h, 001h
	SHIFTDATA?T	_SDA2
	SHIFTCLOCK?T	_SCL2
	SHIFTMODE?C	000h
	SHIFTIN?BC	_i2c_in + 00001h, 008h
	SHIFTDATA?T	_SDA2
	SHIFTCLOCK?T	_SCL2
	SHIFTMODE?C	001h
	SHIFTOUT?CC	001h, 001h
	RETURN?	

	LABEL?L	_I2C_TX2	
	SHIFTDATA?T	_SDA2
	SHIFTCLOCK?T	_SCL2
	SHIFTMODE?C	001h
	SHIFTOUT?BC	_i2c_out, 008h
	SHIFTDATA?T	_SDA2
	SHIFTCLOCK?T	_SCL2
	SHIFTMODE?C	000h
	SHIFTIN?TC	_i2c_ack, 001h
	RETURN?	

	LABEL?L	_BITIS	
	END?	

	END
